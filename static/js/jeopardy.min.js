!function(e){"use strict";e.module("jeopardy",[]).controller("game",["$scope","$document","$timeout","$http","video",function(e,a,o,n,t){location.href.match(/\?reset/)&&(window.confirm("Reset game?")&&localStorage.removeItem("game_"+window.GAME_ID),window.location=window.location.href.split("?")[0]),e.apply=function(){e.$$phase||e.$apply()},window.$scope=e,e.game={},e.loadGame=function(){return n.get("/api/v1/board/"+window.GAME_ID+"/").then(function(a){e.game=a.data,e.game.double_jeopardy=!1,e.game.questions_answered=0,localStorage.setItem("game_"+window.GAME_ID,JSON.stringify(a.data))},function(e){window.console.log("Error loading game:",e)})},e.isValidCategory=function(a){return e.game.final_jeopardy?a.data.final_jeopardy:e.game.double_jeopardy?a.double_jeopardy:e.game.double_jeopardy?void 0:!a.double_jeopardy&&!a.data.final_jeopardy},e.hasFinalJeopardy=function(){return e.game.categories.find(function(e){return e.data.final_jeopardy===!0})||!1},e.startFinalJeopardy=function(){e.game.final_jeopardy=!0,e.final_jeopardy=e.hasFinalJeopardy(),e.final_jeopardy.show="none",o(function(){e.final_jeopardy.show="category"},2500)},e.finalJeopardyClick=function(){switch(e.final_jeopardy.show){case"category":e.final_jeopardy.show="question";break;case"question":e.final_jeopardy.show="answer";break;default:e.final_jeopardy.show="none",e.game.questions_answered++,e.final_jeopardy=null,e.checkGameState()}e.apply(),localStorage.setItem("game_"+window.GAME_ID,JSON.stringify(e.game))},e.finishGame=function(){confirm("Thanks for playing! Restart game?")&&(localStorage.removeItem("game_"+window.GAME_ID),window.location.reload())},e.staticUrl=function(e){return window.STATIC_URL+e},e.uistate={board_loaded:!1},e.checkGameState=function(){e.game.double_jeopardy||30!=e.game.questions_answered?e.game.double_jeopardy&&60==e.game.questions_answered?e.hasFinalJeopardy()?e.startFinalJeopardy():e.finishGame():(!e.game.double_jeopardy&&e.game.questions_answered>30||e.game.double_jeopardy&&e.game.questions_answered>60)&&e.finishGame():e.game.categories.count>=12?e.game.double_jeopardy=!0:e.hasFinalJeopardy()?e.startFinalJeopardy():e.finishGame()},localStorage.getItem("game_"+window.GAME_ID)?(window.console.log("Loading existing game from localStorage..."),e.game=JSON.parse(localStorage.getItem("game_"+window.GAME_ID)),e.apply(),e.checkGameState(),window.console.log("Game Loaded")):e.loadGame(),e.isDailyDouble=function(a){return e.game.daily_doubles.find(function(e){return e==a.id})?!0:!1},e.questionValue=function(a){var o=1;return e.game.double_jeopardy&&(o=2),"$"+200*a.placement*o},e.currentQuestionClick=function(){switch(e.current_question.show){case"daily-double":e.current_question.show="question";break;case"question":e.current_question.show="answer";break;default:e.current_question.show="none",e.game.questions_answered++,e.current_question=null,e.checkGameState()}e.apply(),localStorage.setItem("game_"+window.GAME_ID,JSON.stringify(e.game))},e.questionClick=function(a){switch(a.show){case void 0:a.show=e.isDailyDouble(a)?"daily-double":"question",e.current_question=a;break;case"question":a.show="answer";break;case"answer":a.show="none"}e.apply(),localStorage.setItem("game_"+window.GAME_ID,JSON.stringify(e.game))},e.init=function(){localStorage.getItem("game_"+window.GAME_ID)&&(e.uistate.board_loaded=!0,e.apply(),t.quiet(0)),t.play(),o(function(){t.quiet(.9)},9e3),o(function(){t.quiet(.9),e.uistate.board_loaded=!0,e.apply()},9500)},a.ready(function(){e.init()})}]).factory("video",["$document",function(e){var a=e.find("video")[0],o=function(){a.play()},n=function(){a.muted=!0},t=function(e){a.volume=e,e>0&&setTimeout(function(){t(parseFloat(e-.05).toFixed(2))},500)};return{play:function(){o()},mute:function(){n()},quiet:function(e){t(e)}}}]).directive("gameBoard",function(){return{restrict:"E",templateUrl:function(){return window.STATIC_URL+"templates/game-board.html"}}}).directive("finalJeopardy",function(){return{restrict:"E",templateUrl:function(){return window.STATIC_URL+"templates/final-jeopardy.html"}}})}(window.angular);